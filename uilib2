--[[
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘                    BLOODUI LIBRARY v2.0                          â•‘
    â•‘           Inspired by Fluent UI - Bloody Theme Edition           â•‘
    â•‘                   God-Tier Luau Engineering                      â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    Usage:
    local BloodUI = loadstring(game:HttpGet("YOUR_URL"))()
    local Window = BloodUI:CreateWindow({...})
]]

local BloodUI = {}
BloodUI.__index = BloodUI
BloodUI.Version = "2.0.0"
BloodUI.Windows = {}
BloodUI.Theme = {}
BloodUI.Flags = {}
BloodUI.Options = {}
BloodUI.Connections = {}
BloodUI.Initialized = false

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- SERVICES
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local Services = setmetatable({}, {
    __index = function(self, service)
        local s = game:GetService(service)
        rawset(self, service, s)
        return s
    end
})

local TweenService = Services.TweenService
local UserInputService = Services.UserInputService
local RunService = Services.RunService
local Players = Services.Players
local CoreGui = Services.CoreGui
local TextService = Services.TextService
local HttpService = Services.HttpService

local Player = Players.LocalPlayer
local Mouse = Player:GetMouse()

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- THEME CONFIGURATION
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

BloodUI.Themes = {
    Blood = {
        -- Primary Colors
        Primary = Color3.fromRGB(139, 0, 0),
        PrimaryDark = Color3.fromRGB(100, 0, 0),
        PrimaryLight = Color3.fromRGB(180, 30, 30),
        Accent = Color3.fromRGB(220, 20, 60),
        AccentDark = Color3.fromRGB(178, 34, 34),
        
        -- Background Colors
        Background = Color3.fromRGB(15, 12, 12),
        BackgroundSecondary = Color3.fromRGB(22, 18, 18),
        BackgroundTertiary = Color3.fromRGB(28, 22, 22),
        Surface = Color3.fromRGB(35, 28, 28),
        SurfaceHover = Color3.fromRGB(45, 35, 35),
        
        -- Text Colors
        TextPrimary = Color3.fromRGB(255, 245, 245),
        TextSecondary = Color3.fromRGB(200, 180, 180),
        TextMuted = Color3.fromRGB(140, 120, 120),
        TextAccent = Color3.fromRGB(255, 100, 100),
        
        -- Border Colors
        Border = Color3.fromRGB(60, 40, 40),
        BorderAccent = Color3.fromRGB(139, 0, 0),
        
        -- State Colors
        Success = Color3.fromRGB(50, 180, 50),
        Warning = Color3.fromRGB(220, 180, 30),
        Error = Color3.fromRGB(220, 50, 50),
        Info = Color3.fromRGB(100, 150, 220),
        
        -- Special Effects
        Glow = Color3.fromRGB(180, 0, 0),
        Shadow = Color3.fromRGB(0, 0, 0),
        Gradient1 = Color3.fromRGB(139, 0, 0),
        Gradient2 = Color3.fromRGB(60, 0, 0),
        
        -- Component Specific
        ToggleOn = Color3.fromRGB(180, 30, 30),
        ToggleOff = Color3.fromRGB(60, 45, 45),
        SliderFill = Color3.fromRGB(180, 30, 30),
        SliderTrack = Color3.fromRGB(50, 40, 40),
        DropdownBg = Color3.fromRGB(25, 20, 20),
        TabActive = Color3.fromRGB(139, 0, 0),
        TabInactive = Color3.fromRGB(45, 35, 35),
    },
    
    Crimson = {
        Primary = Color3.fromRGB(220, 20, 60),
        PrimaryDark = Color3.fromRGB(180, 15, 45),
        PrimaryLight = Color3.fromRGB(255, 50, 90),
        Accent = Color3.fromRGB(255, 69, 0),
        AccentDark = Color3.fromRGB(200, 50, 0),
        Background = Color3.fromRGB(12, 10, 12),
        BackgroundSecondary = Color3.fromRGB(18, 14, 18),
        BackgroundTertiary = Color3.fromRGB(25, 20, 25),
        Surface = Color3.fromRGB(32, 25, 32),
        SurfaceHover = Color3.fromRGB(42, 32, 42),
        TextPrimary = Color3.fromRGB(255, 240, 245),
        TextSecondary = Color3.fromRGB(200, 170, 180),
        TextMuted = Color3.fromRGB(140, 110, 120),
        TextAccent = Color3.fromRGB(255, 100, 130),
        Border = Color3.fromRGB(60, 35, 45),
        BorderAccent = Color3.fromRGB(220, 20, 60),
        Success = Color3.fromRGB(50, 200, 80),
        Warning = Color3.fromRGB(255, 200, 50),
        Error = Color3.fromRGB(255, 60, 60),
        Info = Color3.fromRGB(100, 180, 255),
        Glow = Color3.fromRGB(220, 20, 60),
        Shadow = Color3.fromRGB(0, 0, 0),
        Gradient1 = Color3.fromRGB(220, 20, 60),
        Gradient2 = Color3.fromRGB(100, 10, 30),
        ToggleOn = Color3.fromRGB(220, 40, 70),
        ToggleOff = Color3.fromRGB(60, 40, 50),
        SliderFill = Color3.fromRGB(220, 40, 70),
        SliderTrack = Color3.fromRGB(50, 35, 45),
        DropdownBg = Color3.fromRGB(22, 17, 22),
        TabActive = Color3.fromRGB(220, 20, 60),
        TabInactive = Color3.fromRGB(45, 32, 42),
    },
    
    Void = {
        Primary = Color3.fromRGB(90, 0, 120),
        PrimaryDark = Color3.fromRGB(60, 0, 80),
        PrimaryLight = Color3.fromRGB(130, 30, 170),
        Accent = Color3.fromRGB(150, 50, 200),
        AccentDark = Color3.fromRGB(100, 30, 140),
        Background = Color3.fromRGB(8, 6, 12),
        BackgroundSecondary = Color3.fromRGB(14, 10, 20),
        BackgroundTertiary = Color3.fromRGB(20, 15, 28),
        Surface = Color3.fromRGB(28, 22, 38),
        SurfaceHover = Color3.fromRGB(38, 30, 50),
        TextPrimary = Color3.fromRGB(245, 240, 255),
        TextSecondary = Color3.fromRGB(180, 170, 200),
        TextMuted = Color3.fromRGB(120, 110, 140),
        TextAccent = Color3.fromRGB(180, 130, 255),
        Border = Color3.fromRGB(50, 40, 70),
        BorderAccent = Color3.fromRGB(90, 0, 120),
        Success = Color3.fromRGB(80, 200, 120),
        Warning = Color3.fromRGB(255, 200, 80),
        Error = Color3.fromRGB(255, 80, 100),
        Info = Color3.fromRGB(130, 180, 255),
        Glow = Color3.fromRGB(130, 50, 180),
        Shadow = Color3.fromRGB(0, 0, 0),
        Gradient1 = Color3.fromRGB(90, 0, 120),
        Gradient2 = Color3.fromRGB(40, 0, 60),
        ToggleOn = Color3.fromRGB(130, 50, 180),
        ToggleOff = Color3.fromRGB(50, 40, 65),
        SliderFill = Color3.fromRGB(130, 50, 180),
        SliderTrack = Color3.fromRGB(45, 35, 60),
        DropdownBg = Color3.fromRGB(18, 14, 26),
        TabActive = Color3.fromRGB(90, 0, 120),
        TabInactive = Color3.fromRGB(38, 28, 52),
    }
}

BloodUI.CurrentTheme = "Blood"
BloodUI.Theme = BloodUI.Themes.Blood

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- UTILITY FUNCTIONS
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local Utility = {}

function Utility.Create(instanceType, properties)
    local instance = Instance.new(instanceType)
    for prop, value in pairs(properties or {}) do
        if prop ~= "Parent" then
            if typeof(value) == "Instance" then
                value.Parent = instance
            else
                instance[prop] = value
            end
        end
    end
    if properties and properties.Parent then
        instance.Parent = properties.Parent
    end
    return instance
end

function Utility.Tween(instance, properties, duration, style, direction)
    local tweenInfo = TweenInfo.new(
        duration or 0.2,
        style or Enum.EasingStyle.Quart,
        direction or Enum.EasingDirection.Out
    )
    local tween = TweenService:Create(instance, tweenInfo, properties)
    tween:Play()
    return tween
end

function Utility.TweenSequence(tweens)
    local index = 1
    local function playNext()
        if index <= #tweens then
            local tweenData = tweens[index]
            local tween = Utility.Tween(
                tweenData.Instance,
                tweenData.Properties,
                tweenData.Duration,
                tweenData.Style,
                tweenData.Direction
            )
            index = index + 1
            tween.Completed:Connect(playNext)
        end
    end
    playNext()
end

function Utility.Spring(instance, property, target, damping, frequency)
    damping = damping or 0.7
    frequency = frequency or 3
    
    local currentValue = instance[property]
    local velocity = typeof(currentValue) == "number" and 0 or 
                     typeof(currentValue) == "Vector2" and Vector2.new(0, 0) or
                     typeof(currentValue) == "UDim2" and UDim2.new(0, 0, 0, 0)
    
    local connection
    connection = RunService.Heartbeat:Connect(function(dt)
        dt = math.min(dt, 0.05)
        local displacement = target - currentValue
        local springForce = displacement * (frequency * frequency)
        local dampingForce = velocity * (2 * damping * frequency)
        local acceleration = springForce - dampingForce
        velocity = velocity + acceleration * dt
        currentValue = currentValue + velocity * dt
        instance[property] = currentValue
        
        local threshold = 0.001
        if typeof(displacement) == "number" then
            if math.abs(displacement) < threshold and math.abs(velocity) < threshold then
                instance[property] = target
                connection:Disconnect()
            end
        end
    end)
    
    return connection
end

function Utility.Ripple(button, position)
    local theme = BloodUI.Theme
    local ripple = Utility.Create("Frame", {
        Name = "Ripple",
        Parent = button,
        BackgroundColor3 = theme.PrimaryLight,
        BackgroundTransparency = 0.7,
        BorderSizePixel = 0,
        Position = UDim2.new(0, position.X - button.AbsolutePosition.X, 0, position.Y - button.AbsolutePosition.Y),
        Size = UDim2.new(0, 0, 0, 0),
        AnchorPoint = Vector2.new(0.5, 0.5),
        ZIndex = button.ZIndex + 1,
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(1, 0),
        Parent = ripple
    })
    
    local maxSize = math.max(button.AbsoluteSize.X, button.AbsoluteSize.Y) * 2.5
    
    local expandTween = Utility.Tween(ripple, {
        Size = UDim2.new(0, maxSize, 0, maxSize),
        BackgroundTransparency = 1
    }, 0.5, Enum.EasingStyle.Quart, Enum.EasingDirection.Out)
    
    expandTween.Completed:Connect(function()
        ripple:Destroy()
    end)
end

function Utility.AddHoverEffect(frame, hoverColor, normalColor, duration)
    duration = duration or 0.15
    
    frame.MouseEnter:Connect(function()
        Utility.Tween(frame, {BackgroundColor3 = hoverColor}, duration)
    end)
    
    frame.MouseLeave:Connect(function()
        Utility.Tween(frame, {BackgroundColor3 = normalColor}, duration)
    end)
end

function Utility.MakeDraggable(frame, handle)
    handle = handle or frame
    local dragging = false
    local dragStart = nil
    local startPos = nil
    
    handle.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or 
           input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
        end
    end)
    
    handle.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or 
           input.UserInputType == Enum.UserInputType.Touch then
            dragging = false
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or 
                         input.UserInputType == Enum.UserInputType.Touch) then
            local delta = input.Position - dragStart
            Utility.Tween(frame, {
                Position = UDim2.new(
                    startPos.X.Scale, startPos.X.Offset + delta.X,
                    startPos.Y.Scale, startPos.Y.Offset + delta.Y
                )
            }, 0.05)
        end
    end)
end

function Utility.DeepCopy(original)
    local copy = {}
    for key, value in pairs(original) do
        if type(value) == "table" then
            copy[key] = Utility.DeepCopy(value)
        else
            copy[key] = value
        end
    end
    return copy
end

function Utility.GetTextSize(text, size, font, bounds)
    return TextService:GetTextSize(text, size, font, bounds or Vector2.new(math.huge, math.huge))
end

function Utility.Truncate(str, maxLength)
    if #str > maxLength then
        return string.sub(str, 1, maxLength - 3) .. "..."
    end
    return str
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- NOTIFICATION SYSTEM
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local NotificationSystem = {}
NotificationSystem.Notifications = {}
NotificationSystem.Container = nil
NotificationSystem.MaxNotifications = 5
NotificationSystem.DefaultDuration = 5

function NotificationSystem:Initialize()
    if self.Container then return end
    
    local screenGui = Utility.Create("ScreenGui", {
        Name = "BloodUI_Notifications",
        ResetOnSpawn = false,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
        DisplayOrder = 999999
    })
    
    pcall(function() screenGui.Parent = CoreGui end)
    if not screenGui.Parent then
        screenGui.Parent = Player:WaitForChild("PlayerGui")
    end
    
    self.Container = Utility.Create("Frame", {
        Name = "NotificationContainer",
        Parent = screenGui,
        BackgroundTransparency = 1,
        Position = UDim2.new(1, -20, 0, 20),
        Size = UDim2.new(0, 350, 1, -40),
        AnchorPoint = Vector2.new(1, 0),
    })
    
    Utility.Create("UIListLayout", {
        Parent = self.Container,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 10),
        VerticalAlignment = Enum.VerticalAlignment.Top,
        HorizontalAlignment = Enum.HorizontalAlignment.Right,
    })
end

function NotificationSystem:Notify(config)
    self:Initialize()
    
    local theme = BloodUI.Theme
    local title = config.Title or "Notification"
    local content = config.Content or ""
    local duration = config.Duration or self.DefaultDuration
    local notifType = config.Type or "Info"
    local callback = config.Callback
    local actions = config.Actions or {}
    
    local typeColors = {
        Success = theme.Success,
        Warning = theme.Warning,
        Error = theme.Error,
        Info = theme.Info,
        Blood = theme.Primary
    }
    
    local accentColor = typeColors[notifType] or theme.Info
    
    local typeIcons = {
        Success = "âœ“",
        Warning = "âš ",
        Error = "âœ•",
        Info = "â„¹",
        Blood = "ğŸ©¸"
    }
    
    local icon = typeIcons[notifType] or "â„¹"
    
    -- Calculate height
    local contentHeight = 0
    if content ~= "" then
        local textSize = Utility.GetTextSize(content, 13, Enum.Font.Gotham, Vector2.new(280, math.huge))
        contentHeight = textSize.Y + 10
    end
    
    local actionsHeight = #actions > 0 and 40 or 0
    local totalHeight = 50 + contentHeight + actionsHeight
    
    local notification = Utility.Create("Frame", {
        Name = "Notification",
        Parent = self.Container,
        BackgroundColor3 = theme.Surface,
        Size = UDim2.new(1, 0, 0, 0),
        ClipsDescendants = true,
        LayoutOrder = #self.Notifications + 1,
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 10),
        Parent = notification
    })
    
    Utility.Create("UIStroke", {
        Parent = notification,
        Color = accentColor,
        Thickness = 1,
        Transparency = 0.5
    })
    
    -- Accent line
    local accentLine = Utility.Create("Frame", {
        Name = "AccentLine",
        Parent = notification,
        BackgroundColor3 = accentColor,
        Size = UDim2.new(0, 4, 1, -8),
        Position = UDim2.new(0, 4, 0, 4),
        BorderSizePixel = 0,
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 2),
        Parent = accentLine
    })
    
    -- Glow effect
    local glow = Utility.Create("ImageLabel", {
        Name = "Glow",
        Parent = notification,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, -15, 0, -15),
        Size = UDim2.new(1, 30, 1, 30),
        Image = "rbxassetid://5028857084",
        ImageColor3 = accentColor,
        ImageTransparency = 0.85,
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(24, 24, 276, 276),
    })
    
    -- Header
    local header = Utility.Create("Frame", {
        Name = "Header",
        Parent = notification,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 16, 0, 0),
        Size = UDim2.new(1, -32, 0, 45),
    })
    
    local iconLabel = Utility.Create("TextLabel", {
        Name = "Icon",
        Parent = header,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0.5, 0),
        Size = UDim2.new(0, 24, 0, 24),
        AnchorPoint = Vector2.new(0, 0.5),
        Font = Enum.Font.GothamBold,
        Text = icon,
        TextColor3 = accentColor,
        TextSize = 18,
    })
    
    local titleLabel = Utility.Create("TextLabel", {
        Name = "Title",
        Parent = header,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 32, 0.5, 0),
        Size = UDim2.new(1, -70, 0, 20),
        AnchorPoint = Vector2.new(0, 0.5),
        Font = Enum.Font.GothamBold,
        Text = title,
        TextColor3 = theme.TextPrimary,
        TextSize = 14,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextTruncate = Enum.TextTruncate.AtEnd,
    })
    
    local closeButton = Utility.Create("TextButton", {
        Name = "Close",
        Parent = header,
        BackgroundTransparency = 1,
        Position = UDim2.new(1, -20, 0.5, 0),
        Size = UDim2.new(0, 20, 0, 20),
        AnchorPoint = Vector2.new(0.5, 0.5),
        Font = Enum.Font.GothamBold,
        Text = "Ã—",
        TextColor3 = theme.TextMuted,
        TextSize = 20,
    })
    
    closeButton.MouseEnter:Connect(function()
        Utility.Tween(closeButton, {TextColor3 = theme.Error}, 0.1)
    end)
    
    closeButton.MouseLeave:Connect(function()
        Utility.Tween(closeButton, {TextColor3 = theme.TextMuted}, 0.1)
    end)
    
    -- Content
    if content ~= "" then
        local contentLabel = Utility.Create("TextLabel", {
            Name = "Content",
            Parent = notification,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 16, 0, 45),
            Size = UDim2.new(1, -32, 0, contentHeight),
            Font = Enum.Font.Gotham,
            Text = content,
            TextColor3 = theme.TextSecondary,
            TextSize = 13,
            TextXAlignment = Enum.TextXAlignment.Left,
            TextYAlignment = Enum.TextYAlignment.Top,
            TextWrapped = true,
        })
    end
    
    -- Actions
    if #actions > 0 then
        local actionsContainer = Utility.Create("Frame", {
            Name = "Actions",
            Parent = notification,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 16, 1, -45),
            Size = UDim2.new(1, -32, 0, 35),
        })
        
        Utility.Create("UIListLayout", {
            Parent = actionsContainer,
            FillDirection = Enum.FillDirection.Horizontal,
            SortOrder = Enum.SortOrder.LayoutOrder,
            Padding = UDim.new(0, 8),
            VerticalAlignment = Enum.VerticalAlignment.Center,
            HorizontalAlignment = Enum.HorizontalAlignment.Right,
        })
        
        for i, action in ipairs(actions) do
            local actionButton = Utility.Create("TextButton", {
                Name = action.Name or ("Action" .. i),
                Parent = actionsContainer,
                BackgroundColor3 = action.Primary and accentColor or theme.SurfaceHover,
                Size = UDim2.new(0, 80, 0, 28),
                Font = Enum.Font.GothamMedium,
                Text = action.Name or "Action",
                TextColor3 = action.Primary and theme.TextPrimary or theme.TextSecondary,
                TextSize = 12,
                LayoutOrder = i,
            })
            
            Utility.Create("UICorner", {
                CornerRadius = UDim.new(0, 6),
                Parent = actionButton
            })
            
            actionButton.MouseButton1Click:Connect(function()
                if action.Callback then
                    action.Callback()
                end
                self:DismissNotification(notification)
            end)
            
            Utility.AddHoverEffect(
                actionButton,
                action.Primary and theme.PrimaryLight or theme.Surface,
                action.Primary and accentColor or theme.SurfaceHover
            )
        end
    end
    
    -- Progress bar
    local progressBar = Utility.Create("Frame", {
        Name = "ProgressBar",
        Parent = notification,
        BackgroundColor3 = accentColor,
        Position = UDim2.new(0, 0, 1, -3),
        Size = UDim2.new(1, 0, 0, 3),
        BorderSizePixel = 0,
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 2),
        Parent = progressBar
    })
    
    table.insert(self.Notifications, notification)
    
    -- Limit notifications
    while #self.Notifications > self.MaxNotifications do
        local oldest = table.remove(self.Notifications, 1)
        self:DismissNotification(oldest)
    end
    
    -- Animate in
    Utility.Tween(notification, {Size = UDim2.new(1, 0, 0, totalHeight)}, 0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
    
    -- Progress animation
    Utility.Tween(progressBar, {Size = UDim2.new(0, 0, 0, 3)}, duration, Enum.EasingStyle.Linear)
    
    -- Close handlers
    local function dismiss()
        self:DismissNotification(notification)
    end
    
    closeButton.MouseButton1Click:Connect(dismiss)
    
    -- Auto dismiss
    task.delay(duration, function()
        if notification.Parent then
            dismiss()
        end
    end)
    
    return notification
end

function NotificationSystem:DismissNotification(notification)
    local index = table.find(self.Notifications, notification)
    if index then
        table.remove(self.Notifications, index)
    end
    
    Utility.Tween(notification, {
        Size = UDim2.new(1, 0, 0, 0),
        BackgroundTransparency = 1
    }, 0.2, Enum.EasingStyle.Quart, Enum.EasingDirection.In).Completed:Connect(function()
        notification:Destroy()
    end)
end

function NotificationSystem:ClearAll()
    for _, notification in ipairs(self.Notifications) do
        self:DismissNotification(notification)
    end
end

BloodUI.Notification = NotificationSystem

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- WINDOW CLASS
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local Window = {}
Window.__index = Window

function BloodUI:CreateWindow(config)
    config = config or {}
    local window = setmetatable({}, Window)
    
    window.Name = config.Name or "BloodUI Window"
    window.Subtitle = config.Subtitle or ""
    window.Size = config.Size or UDim2.new(0, 650, 0, 450)
    window.Tabs = {}
    window.ActiveTab = nil
    window.Visible = true
    window.Minimized = false
    window.Theme = BloodUI.Theme
    
    -- Create ScreenGui
    window.ScreenGui = Utility.Create("ScreenGui", {
        Name = "BloodUI_" .. window.Name:gsub("%s+", ""),
        ResetOnSpawn = false,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
        DisplayOrder = 999998
    })
    
    pcall(function() window.ScreenGui.Parent = CoreGui end)
    if not window.ScreenGui.Parent then
        window.ScreenGui.Parent = Player:WaitForChild("PlayerGui")
    end
    
    local theme = window.Theme
    
    -- Main container
    window.Main = Utility.Create("Frame", {
        Name = "Main",
        Parent = window.ScreenGui,
        BackgroundColor3 = theme.Background,
        Position = UDim2.new(0.5, 0, 0.5, 0),
        Size = UDim2.new(0, 0, 0, 0),
        AnchorPoint = Vector2.new(0.5, 0.5),
        ClipsDescendants = true,
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 12),
        Parent = window.Main
    })
    
    Utility.Create("UIStroke", {
        Parent = window.Main,
        Color = theme.Border,
        Thickness = 1,
    })
    
    -- Shadow
    local shadow = Utility.Create("ImageLabel", {
        Name = "Shadow",
        Parent = window.Main,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, -25, 0, -25),
        Size = UDim2.new(1, 50, 1, 50),
        ZIndex = -1,
        Image = "rbxassetid://5028857084",
        ImageColor3 = theme.Shadow,
        ImageTransparency = 0.5,
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(24, 24, 276, 276),
    })
    
    -- Gradient overlay
    local gradientFrame = Utility.Create("Frame", {
        Name = "GradientOverlay",
        Parent = window.Main,
        BackgroundTransparency = 0.95,
        Size = UDim2.new(1, 0, 0, 100),
        Position = UDim2.new(0, 0, 0, 0),
        ZIndex = 0,
        BorderSizePixel = 0,
    })
    
    Utility.Create("UIGradient", {
        Parent = gradientFrame,
        Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, theme.Gradient1),
            ColorSequenceKeypoint.new(1, theme.Background)
        }),
        Rotation = 90,
        Transparency = NumberSequence.new({
            NumberSequenceKeypoint.new(0, 0.8),
            NumberSequenceKeypoint.new(1, 1)
        })
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 12),
        Parent = gradientFrame
    })
    
    -- Title bar
    window.TitleBar = Utility.Create("Frame", {
        Name = "TitleBar",
        Parent = window.Main,
        BackgroundColor3 = theme.BackgroundSecondary,
        Size = UDim2.new(1, 0, 0, 50),
        BorderSizePixel = 0,
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 12),
        Parent = window.TitleBar
    })
    
    -- Fix corner rounding at bottom
    local titleBarFix = Utility.Create("Frame", {
        Name = "TitleBarFix",
        Parent = window.TitleBar,
        BackgroundColor3 = theme.BackgroundSecondary,
        Position = UDim2.new(0, 0, 1, -12),
        Size = UDim2.new(1, 0, 0, 12),
        BorderSizePixel = 0,
    })
    
    -- Title content
    local titleContainer = Utility.Create("Frame", {
        Name = "TitleContainer",
        Parent = window.TitleBar,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 16, 0, 0),
        Size = UDim2.new(1, -32, 1, 0),
    })
    
    -- Blood icon
    local bloodIcon = Utility.Create("TextLabel", {
        Name = "BloodIcon",
        Parent = titleContainer,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0.5, 0),
        Size = UDim2.new(0, 30, 0, 30),
        AnchorPoint = Vector2.new(0, 0.5),
        Font = Enum.Font.GothamBold,
        Text = "ğŸ©¸",
        TextSize = 22,
    })
    
    local titleLabel = Utility.Create("TextLabel", {
        Name = "Title",
        Parent = titleContainer,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 38, 0.5, window.Subtitle ~= "" and -8 or 0),
        Size = UDim2.new(0.5, -38, 0, 20),
        AnchorPoint = Vector2.new(0, 0.5),
        Font = Enum.Font.GothamBold,
        Text = window.Name,
        TextColor3 = theme.TextPrimary,
        TextSize = 16,
        TextXAlignment = Enum.TextXAlignment.Left,
    })
    
    if window.Subtitle ~= "" then
        local subtitleLabel = Utility.Create("TextLabel", {
            Name = "Subtitle",
            Parent = titleContainer,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 38, 0.5, 8),
            Size = UDim2.new(0.5, -38, 0, 16),
            AnchorPoint = Vector2.new(0, 0.5),
            Font = Enum.Font.Gotham,
            Text = window.Subtitle,
            TextColor3 = theme.TextMuted,
            TextSize = 12,
            TextXAlignment = Enum.TextXAlignment.Left,
        })
    end
    
    -- Window controls
    local controlsContainer = Utility.Create("Frame", {
        Name = "Controls",
        Parent = titleContainer,
        BackgroundTransparency = 1,
        Position = UDim2.new(1, 0, 0.5, 0),
        Size = UDim2.new(0, 90, 0, 30),
        AnchorPoint = Vector2.new(1, 0.5),
    })
    
    Utility.Create("UIListLayout", {
        Parent = controlsContainer,
        FillDirection = Enum.FillDirection.Horizontal,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 8),
        VerticalAlignment = Enum.VerticalAlignment.Center,
        HorizontalAlignment = Enum.HorizontalAlignment.Right,
    })
    
    local function createControlButton(name, text, color, hoverColor, callback)
        local btn = Utility.Create("TextButton", {
            Name = name,
            Parent = controlsContainer,
            BackgroundColor3 = theme.Surface,
            Size = UDim2.new(0, 26, 0, 26),
            Font = Enum.Font.GothamBold,
            Text = text,
            TextColor3 = color,
            TextSize = 14,
        })
        
        Utility.Create("UICorner", {
            CornerRadius = UDim.new(0, 6),
            Parent = btn
        })
        
        btn.MouseEnter:Connect(function()
            Utility.Tween(btn, {BackgroundColor3 = hoverColor, TextColor3 = theme.TextPrimary}, 0.1)
        end)
        
        btn.MouseLeave:Connect(function()
            Utility.Tween(btn, {BackgroundColor3 = theme.Surface, TextColor3 = color}, 0.1)
        end)
        
        btn.MouseButton1Click:Connect(callback)
        
        return btn
    end
    
    createControlButton("Minimize", "âˆ’", theme.TextMuted, theme.Warning, function()
        window:ToggleMinimize()
    end)
    
    createControlButton("Close", "Ã—", theme.TextMuted, theme.Error, function()
        window:Hide()
    end)
    
    -- Make title bar draggable
    Utility.MakeDraggable(window.Main, window.TitleBar)
    
    -- Tab container (sidebar)
    window.TabContainer = Utility.Create("Frame", {
        Name = "TabContainer",
        Parent = window.Main,
        BackgroundColor3 = theme.BackgroundSecondary,
        Position = UDim2.new(0, 0, 0, 50),
        Size = UDim2.new(0, 160, 1, -50),
        BorderSizePixel = 0,
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 12),
        Parent = window.TabContainer
    })
    
    -- Fix corner at top
    local tabContainerFix = Utility.Create("Frame", {
        Name = "TabContainerFix",
        Parent = window.TabContainer,
        BackgroundColor3 = theme.BackgroundSecondary,
        Position = UDim2.new(0, 0, 0, 0),
        Size = UDim2.new(1, 0, 0, 12),
        BorderSizePixel = 0,
    })
    
    local tabContainerFixRight = Utility.Create("Frame", {
        Name = "TabContainerFixRight",
        Parent = window.TabContainer,
        BackgroundColor3 = theme.BackgroundSecondary,
        Position = UDim2.new(1, -12, 0, 0),
        Size = UDim2.new(0, 12, 1, 0),
        BorderSizePixel = 0,
    })
    
    -- Tab scroll frame
    window.TabScroll = Utility.Create("ScrollingFrame", {
        Name = "TabScroll",
        Parent = window.TabContainer,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 8, 0, 8),
        Size = UDim2.new(1, -16, 1, -16),
        CanvasSize = UDim2.new(0, 0, 0, 0),
        ScrollBarThickness = 3,
        ScrollBarImageColor3 = theme.Primary,
        BorderSizePixel = 0,
        ScrollingDirection = Enum.ScrollingDirection.Y,
        AutomaticCanvasSize = Enum.AutomaticSize.Y,
    })
    
    Utility.Create("UIListLayout", {
        Parent = window.TabScroll,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 4),
    })
    
    Utility.Create("UIPadding", {
        Parent = window.TabScroll,
        PaddingTop = UDim.new(0, 4),
        PaddingBottom = UDim.new(0, 4),
    })
    
    -- Content container
    window.ContentContainer = Utility.Create("Frame", {
        Name = "ContentContainer",
        Parent = window.Main,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 168, 0, 58),
        Size = UDim2.new(1, -176, 1, -66),
        ClipsDescendants = true,
    })
    
    -- Animate window open
    task.spawn(function()
        Utility.Tween(window.Main, {Size = window.Size}, 0.4, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
    end)
    
    table.insert(BloodUI.Windows, window)
    BloodUI.Initialized = true
    
    return window
end

function Window:CreateTab(config)
    config = config or {}
    local tab = {}
    
    tab.Name = config.Name or "Tab"
    tab.Icon = config.Icon or ""
    tab.Window = self
    tab.Groupboxes = {}
    tab.Active = false
    tab.LayoutOrder = #self.Tabs + 1
    
    local theme = self.Theme
    
    -- Tab button
    tab.Button = Utility.Create("TextButton", {
        Name = tab.Name .. "_Button",
        Parent = self.TabScroll,
        BackgroundColor3 = theme.TabInactive,
        Size = UDim2.new(1, 0, 0, 38),
        Font = Enum.Font.GothamMedium,
        Text = "",
        TextColor3 = theme.TextSecondary,
        TextSize = 13,
        LayoutOrder = tab.LayoutOrder,
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 8),
        Parent = tab.Button
    })
    
    -- Tab indicator
    tab.Indicator = Utility.Create("Frame", {
        Name = "Indicator",
        Parent = tab.Button,
        BackgroundColor3 = theme.Primary,
        Position = UDim2.new(0, 0, 0.5, 0),
        Size = UDim2.new(0, 3, 0, 0),
        AnchorPoint = Vector2.new(0, 0.5),
        BorderSizePixel = 0,
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 2),
        Parent = tab.Indicator
    })
    
    -- Icon
    local iconLabel = Utility.Create("TextLabel", {
        Name = "Icon",
        Parent = tab.Button,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 12, 0.5, 0),
        Size = UDim2.new(0, 20, 0, 20),
        AnchorPoint = Vector2.new(0, 0.5),
        Font = Enum.Font.GothamBold,
        Text = tab.Icon,
        TextColor3 = theme.TextMuted,
        TextSize = 14,
    })
    
    -- Tab name
    local nameLabel = Utility.Create("TextLabel", {
        Name = "Name",
        Parent = tab.Button,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, tab.Icon ~= "" and 38 or 14, 0.5, 0),
        Size = UDim2.new(1, -(tab.Icon ~= "" and 46 or 22), 0, 20),
        AnchorPoint = Vector2.new(0, 0.5),
        Font = Enum.Font.GothamMedium,
        Text = tab.Name,
        TextColor3 = theme.TextSecondary,
        TextSize = 13,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextTruncate = Enum.TextTruncate.AtEnd,
    })
    
    -- Tab content
    tab.Content = Utility.Create("ScrollingFrame", {
        Name = tab.Name .. "_Content",
        Parent = self.ContentContainer,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        CanvasSize = UDim2.new(0, 0, 0, 0),
        ScrollBarThickness = 4,
        ScrollBarImageColor3 = theme.Primary,
        BorderSizePixel = 0,
        Visible = false,
        AutomaticCanvasSize = Enum.AutomaticSize.Y,
    })
    
    -- Two-column layout container
    tab.LeftColumn = Utility.Create("Frame", {
        Name = "LeftColumn",
        Parent = tab.Content,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0, 0),
        Size = UDim2.new(0.5, -6, 1, 0),
    })
    
    Utility.Create("UIListLayout", {
        Parent = tab.LeftColumn,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 8),
    })
    
    tab.RightColumn = Utility.Create("Frame", {
        Name = "RightColumn",
        Parent = tab.Content,
        BackgroundTransparency = 1,
        Position = UDim2.new(0.5, 6, 0, 0),
        Size = UDim2.new(0.5, -6, 1, 0),
    })
    
    Utility.Create("UIListLayout", {
        Parent = tab.RightColumn,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 8),
    })
    
    -- Button interactions
    tab.Button.MouseEnter:Connect(function()
        if not tab.Active then
            Utility.Tween(tab.Button, {BackgroundColor3 = theme.SurfaceHover}, 0.15)
        end
    end)
    
    tab.Button.MouseLeave:Connect(function()
        if not tab.Active then
            Utility.Tween(tab.Button, {BackgroundColor3 = theme.TabInactive}, 0.15)
        end
    end)
    
    tab.Button.MouseButton1Click:Connect(function()
        self:SelectTab(tab)
    end)
    
    function tab:CreateGroupbox(config)
        return self.Window:CreateGroupbox(self, config)
    end
    
    table.insert(self.Tabs, tab)
    
    -- Select first tab automatically
    if #self.Tabs == 1 then
        self:SelectTab(tab)
    end
    
    return tab
end

function Window:SelectTab(tab)
    local theme = self.Theme
    
    -- Deselect previous tab
    if self.ActiveTab then
        self.ActiveTab.Active = false
        Utility.Tween(self.ActiveTab.Button, {BackgroundColor3 = theme.TabInactive}, 0.2)
        Utility.Tween(self.ActiveTab.Indicator, {Size = UDim2.new(0, 3, 0, 0)}, 0.2)
        Utility.Tween(self.ActiveTab.Button:FindFirstChild("Name"), {TextColor3 = theme.TextSecondary}, 0.2)
        
        -- Fade out content
        Utility.Tween(self.ActiveTab.Content, {}, 0.15).Completed:Connect(function()
            if self.ActiveTab ~= tab then
                self.ActiveTab.Content.Visible = false
            end
        end)
    end
    
    -- Select new tab
    tab.Active = true
    self.ActiveTab = tab
    
    Utility.Tween(tab.Button, {BackgroundColor3 = theme.TabActive}, 0.2)
    Utility.Tween(tab.Indicator, {Size = UDim2.new(0, 3, 0, 20)}, 0.2, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
    Utility.Tween(tab.Button:FindFirstChild("Name"), {TextColor3 = theme.TextPrimary}, 0.2)
    
    tab.Content.Visible = true
    
    -- Ripple effect
    local pos = Vector2.new(
        tab.Button.AbsolutePosition.X + tab.Button.AbsoluteSize.X / 2,
        tab.Button.AbsolutePosition.Y + tab.Button.AbsoluteSize.Y / 2
    )
    Utility.Ripple(tab.Button, pos)
end

function Window:CreateGroupbox(tab, config)
    config = config or {}
    local groupbox = {}
    
    groupbox.Name = config.Name or "Groupbox"
    groupbox.Side = config.Side or "Left"
    groupbox.Tab = tab
    groupbox.Elements = {}
    groupbox.LayoutOrder = #tab.Groupboxes + 1
    
    local theme = self.Theme
    local parent = groupbox.Side == "Left" and tab.LeftColumn or tab.RightColumn
    
    groupbox.Container = Utility.Create("Frame", {
        Name = groupbox.Name .. "_Groupbox",
        Parent = parent,
        BackgroundColor3 = theme.Surface,
        Size = UDim2.new(1, 0, 0, 50),
        AutomaticSize = Enum.AutomaticSize.Y,
        LayoutOrder = groupbox.LayoutOrder,
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 10),
        Parent = groupbox.Container
    })
    
    Utility.Create("UIStroke", {
        Parent = groupbox.Container,
        Color = theme.Border,
        Thickness = 1,
        Transparency = 0.5,
    })
    
    -- Header
    local header = Utility.Create("Frame", {
        Name = "Header",
        Parent = groupbox.Container,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 36),
        Position = UDim2.new(0, 0, 0, 0),
    })
    
    local headerAccent = Utility.Create("Frame", {
        Name = "Accent",
        Parent = header,
        BackgroundColor3 = theme.Primary,
        Position = UDim2.new(0, 12, 0.5, 0),
        Size = UDim2.new(0, 3, 0, 16),
        AnchorPoint = Vector2.new(0, 0.5),
        BorderSizePixel = 0,
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 2),
        Parent = headerAccent
    })
    
    local headerTitle = Utility.Create("TextLabel", {
        Name = "Title",
        Parent = header,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 24, 0.5, 0),
        Size = UDim2.new(1, -32, 0, 20),
        AnchorPoint = Vector2.new(0, 0.5),
        Font = Enum.Font.GothamBold,
        Text = groupbox.Name,
        TextColor3 = theme.TextPrimary,
        TextSize = 13,
        TextXAlignment = Enum.TextXAlignment.Left,
    })
    
    -- Content container
    groupbox.Content = Utility.Create("Frame", {
        Name = "Content",
        Parent = groupbox.Container,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0, 36),
        Size = UDim2.new(1, 0, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
    })
    
    Utility.Create("UIListLayout", {
        Parent = groupbox.Content,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 6),
    })
    
    Utility.Create("UIPadding", {
        Parent = groupbox.Content,
        PaddingLeft = UDim.new(0, 12),
        PaddingRight = UDim.new(0, 12),
        PaddingBottom = UDim.new(0, 12),
    })
    
    -- Element creation functions
    function groupbox:AddLabel(config)
        return self.Tab.Window:CreateLabel(self, config)
    end
    
    function groupbox:AddToggle(config)
        return self.Tab.Window:CreateToggle(self, config)
    end
    
    function groupbox:AddSlider(config)
        return self.Tab.Window:CreateSlider(self, config)
    end
    
    function groupbox:AddDropdown(config)
        return self.Tab.Window:CreateDropdown(self, config)
    end
    
    function groupbox:AddButton(config)
        return self.Tab.Window:CreateButton(self, config)
    end
    
    function groupbox:AddKeybind(config)
        return self.Tab.Window:CreateKeybind(self, config)
    end
    
    function groupbox:AddTextbox(config)
        return self.Tab.Window:CreateTextbox(self, config)
    end
    
    function groupbox:AddColorPicker(config)
        return self.Tab.Window:CreateColorPicker(self, config)
    end
    
    table.insert(tab.Groupboxes, groupbox)
    
    return groupbox
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- UI ELEMENTS
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function Window:CreateLabel(groupbox, config)
    config = config or {}
    local theme = self.Theme
    
    local label = {
        Type = "Label",
        Text = config.Text or "Label",
    }
    
    label.Container = Utility.Create("Frame", {
        Name = "Label",
        Parent = groupbox.Content,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 20),
        LayoutOrder = #groupbox.Elements + 1,
    })
    
    label.TextLabel = Utility.Create("TextLabel", {
        Name = "Text",
        Parent = label.Container,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        Font = Enum.Font.Gotham,
        Text = label.Text,
        TextColor3 = theme.TextSecondary,
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextWrapped = true,
    })
    
    function label:SetText(text)
        self.Text = text
        self.TextLabel.Text = text
    end
    
    table.insert(groupbox.Elements, label)
    BloodUI.Options[config.Flag] = label
    
    return label
end

function Window:CreateToggle(groupbox, config)
    config = config or {}
    local theme = self.Theme
    
    local toggle = {
        Type = "Toggle",
        Name = config.Name or "Toggle",
        Value = config.Default or false,
        Flag = config.Flag,
        Callback = config.Callback or function() end,
        Tooltip = config.Tooltip,
    }
    
    toggle.Container = Utility.Create("Frame", {
        Name = toggle.Name .. "_Toggle",
        Parent = groupbox.Content,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 28),
        LayoutOrder = #groupbox.Elements + 1,
    })
    
    local textLabel = Utility.Create("TextLabel", {
        Name = "Label",
        Parent = toggle.Container,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0.5, 0),
        Size = UDim2.new(1, -50, 0, 20),
        AnchorPoint = Vector2.new(0, 0.5),
        Font = Enum.Font.Gotham,
        Text = toggle.Name,
        TextColor3 = theme.TextSecondary,
        TextSize = 13,
        TextXAlignment = Enum.TextXAlignment.Left,
    })
    
    toggle.ToggleFrame = Utility.Create("Frame", {
        Name = "ToggleFrame",
        Parent = toggle.Container,
        BackgroundColor3 = toggle.Value and theme.ToggleOn or theme.ToggleOff,
        Position = UDim2.new(1, -40, 0.5, 0),
        Size = UDim2.new(0, 40, 0, 22),
        AnchorPoint = Vector2.new(0, 0.5),
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(1, 0),
        Parent = toggle.ToggleFrame
    })
    
    toggle.Knob = Utility.Create("Frame", {
        Name = "Knob",
        Parent = toggle.ToggleFrame,
        BackgroundColor3 = theme.TextPrimary,
        Position = toggle.Value and UDim2.new(1, -4, 0.5, 0) or UDim2.new(0, 4, 0.5, 0),
        Size = UDim2.new(0, 16, 0, 16),
        AnchorPoint = Vector2.new(toggle.Value and 1 or 0, 0.5),
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(1, 0),
        Parent = toggle.Knob
    })
    
    -- Glow effect for knob
    local knobGlow = Utility.Create("ImageLabel", {
        Name = "Glow",
        Parent = toggle.Knob,
        BackgroundTransparency = 1,
        Position = UDim2.new(0.5, 0, 0.5, 0),
        Size = UDim2.new(0, 30, 0, 30),
        AnchorPoint = Vector2.new(0.5, 0.5),
        Image = "rbxassetid://5028857084",
        ImageColor3 = theme.Glow,
        ImageTransparency = toggle.Value and 0.7 or 1,
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(24, 24, 276, 276),
        ZIndex = -1,
    })
    
    local function updateVisual()
        if toggle.Value then
            Utility.Tween(toggle.ToggleFrame, {BackgroundColor3 = theme.ToggleOn}, 0.2)
            Utility.Tween(toggle.Knob, {
                Position = UDim2.new(1, -4, 0.5, 0),
                AnchorPoint = Vector2.new(1, 0.5)
            }, 0.2, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
            Utility.Tween(knobGlow, {ImageTransparency = 0.7}, 0.2)
            Utility.Tween(textLabel, {TextColor3 = theme.TextPrimary}, 0.2)
        else
            Utility.Tween(toggle.ToggleFrame, {BackgroundColor3 = theme.ToggleOff}, 0.2)
            Utility.Tween(toggle.Knob, {
                Position = UDim2.new(0, 4, 0.5, 0),
                AnchorPoint = Vector2.new(0, 0.5)
            }, 0.2, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
            Utility.Tween(knobGlow, {ImageTransparency = 1}, 0.2)
            Utility.Tween(textLabel, {TextColor3 = theme.TextSecondary}, 0.2)
        end
    end
    
    local button = Utility.Create("TextButton", {
        Name = "Button",
        Parent = toggle.Container,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        Text = "",
    })
    
    button.MouseButton1Click:Connect(function()
        toggle.Value = not toggle.Value
        updateVisual()
        toggle.Callback(toggle.Value)
    end)
    
    function toggle:SetValue(value)
        self.Value = value
        updateVisual()
        self.Callback(value)
    end
    
    function toggle:OnChanged(callback)
        self.Callback = callback
        return self
    end
    
    if toggle.Flag then
        BloodUI.Flags[toggle.Flag] = toggle.Value
    end
    
    table.insert(groupbox.Elements, toggle)
    BloodUI.Options[config.Flag] = toggle
    
    return toggle
end

function Window:CreateSlider(groupbox, config)
    config = config or {}
    local theme = self.Theme
    
    local slider = {
        Type = "Slider",
        Name = config.Name or "Slider",
        Value = config.Default or config.Min or 0,
        Min = config.Min or 0,
        Max = config.Max or 100,
        Rounding = config.Rounding or 0,
        Suffix = config.Suffix or "",
        Flag = config.Flag,
        Callback = config.Callback or function() end,
    }
    
    slider.Container = Utility.Create("Frame", {
        Name = slider.Name .. "_Slider",
        Parent = groupbox.Content,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 45),
        LayoutOrder = #groupbox.Elements + 1,
    })
    
    local headerFrame = Utility.Create("Frame", {
        Name = "Header",
        Parent = slider.Container,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 20),
    })
    
    local textLabel = Utility.Create("TextLabel", {
        Name = "Label",
        Parent = headerFrame,
        BackgroundTransparency = 1,
        Size = UDim2.new(0.7, 0, 1, 0),
        Font = Enum.Font.Gotham,
        Text = slider.Name,
        TextColor3 = theme.TextSecondary,
        TextSize = 13,
        TextXAlignment = Enum.TextXAlignment.Left,
    })
    
    slider.ValueLabel = Utility.Create("TextLabel", {
        Name = "Value",
        Parent = headerFrame,
        BackgroundTransparency = 1,
        Position = UDim2.new(1, 0, 0, 0),
        Size = UDim2.new(0.3, 0, 1, 0),
        AnchorPoint = Vector2.new(1, 0),
        Font = Enum.Font.GothamBold,
        Text = tostring(slider.Value) .. slider.Suffix,
        TextColor3 = theme.TextAccent,
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Right,
    })
    
    slider.SliderTrack = Utility.Create("Frame", {
        Name = "Track",
        Parent = slider.Container,
        BackgroundColor3 = theme.SliderTrack,
        Position = UDim2.new(0, 0, 0, 28),
        Size = UDim2.new(1, 0, 0, 8),
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(1, 0),
        Parent = slider.SliderTrack
    })
    
    local fillPercent = (slider.Value - slider.Min) / (slider.Max - slider.Min)
    
    slider.Fill = Utility.Create("Frame", {
        Name = "Fill",
        Parent = slider.SliderTrack,
        BackgroundColor3 = theme.SliderFill,
        Size = UDim2.new(fillPercent, 0, 1, 0),
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(1, 0),
        Parent = slider.Fill
    })
    
    -- Gradient on fill
    Utility.Create("UIGradient", {
        Parent = slider.Fill,
        Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, theme.Primary),
            ColorSequenceKeypoint.new(1, theme.PrimaryLight)
        }),
    })
    
    slider.Knob = Utility.Create("Frame", {
        Name = "Knob",
        Parent = slider.SliderTrack,
        BackgroundColor3 = theme.TextPrimary,
        Position = UDim2.new(fillPercent, 0, 0.5, 0),
        Size = UDim2.new(0, 16, 0, 16),
        AnchorPoint = Vector2.new(0.5, 0.5),
        ZIndex = 2,
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(1, 0),
        Parent = slider.Knob
    })
    
    Utility.Create("UIStroke", {
        Parent = slider.Knob,
        Color = theme.Primary,
        Thickness = 2,
    })
    
    local function updateSlider(input)
        local pos = UDim2.new(
            math.clamp((input.Position.X - slider.SliderTrack.AbsolutePosition.X) / slider.SliderTrack.AbsoluteSize.X, 0, 1),
            0, 0.5, 0
        )
        
        local value = slider.Min + (pos.X.Scale * (slider.Max - slider.Min))
        
        if slider.Rounding == 0 then
            value = math.floor(value)
        else
            value = math.floor(value * (10 ^ slider.Rounding)) / (10 ^ slider.Rounding)
        end
        
        slider.Value = value
        
        Utility.Tween(slider.Fill, {Size = UDim2.new(pos.X.Scale, 0, 1, 0)}, 0.05)
        Utility.Tween(slider.Knob, {Position = pos}, 0.05)
        
        slider.ValueLabel.Text = tostring(value) .. slider.Suffix
        slider.Callback(value)
        
        if slider.Flag then
            BloodUI.Flags[slider.Flag] = value
        end
    end
    
    local dragging = false
    
    slider.SliderTrack.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or 
           input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            updateSlider(input)
        end
    end)
    
    slider.SliderTrack.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or 
           input.UserInputType == Enum.UserInputType.Touch then
            dragging = false
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or 
                         input.UserInputType == Enum.UserInputType.Touch) then
            updateSlider(input)
        end
    end)
    
    function slider:SetValue(value)
        self.Value = math.clamp(value, self.Min, self.Max)
        local percent = (self.Value - self.Min) / (self.Max - self.Min)
        
        Utility.Tween(self.Fill, {Size = UDim2.new(percent, 0, 1, 0)}, 0.1)
        Utility.Tween(self.Knob, {Position = UDim2.new(percent, 0, 0.5, 0)}, 0.1)
        
        self.ValueLabel.Text = tostring(self.Value) .. self.Suffix
        self.Callback(self.Value)
    end
    
    function slider:OnChanged(callback)
        self.Callback = callback
        return self
    end
    
    if slider.Flag then
        BloodUI.Flags[slider.Flag] = slider.Value
    end
    
    table.insert(groupbox.Elements, slider)
    BloodUI.Options[config.Flag] = slider
    
    return slider
end

function Window:CreateDropdown(groupbox, config)
    config = config or {}
    local theme = self.Theme
    
    local dropdown = {
        Type = "Dropdown",
        Name = config.Name or "Dropdown",
        Values = config.Values or {},
        Value = config.Default or (config.Values and config.Values[1]) or "",
        Multi = config.Multi or false,
        Flag = config.Flag,
        Callback = config.Callback or function() end,
        Open = false,
    }
    
    if dropdown.Multi then
        dropdown.Value = config.Default or {}
    end
    
    dropdown.Container = Utility.Create("Frame", {
        Name = dropdown.Name .. "_Dropdown",
        Parent = groupbox.Content,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 55),
        ClipsDescendants = false,
        LayoutOrder = #groupbox.Elements + 1,
    })
    
    local textLabel = Utility.Create("TextLabel", {
        Name = "Label",
        Parent = dropdown.Container,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 20),
        Font = Enum.Font.Gotham,
        Text = dropdown.Name,
        TextColor3 = theme.TextSecondary,
        TextSize = 13,
        TextXAlignment = Enum.TextXAlignment.Left,
    })
    
    dropdown.Button = Utility.Create("TextButton", {
        Name = "Button",
        Parent = dropdown.Container,
        BackgroundColor3 = theme.DropdownBg,
        Position = UDim2.new(0, 0, 0, 24),
        Size = UDim2.new(1, 0, 0, 30),
        Font = Enum.Font.Gotham,
        Text = "",
        TextColor3 = theme.TextPrimary,
        TextSize = 12,
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 6),
        Parent = dropdown.Button
    })
    
    Utility.Create("UIStroke", {
        Parent = dropdown.Button,
        Color = theme.Border,
        Thickness = 1,
    })
    
    dropdown.SelectedText = Utility.Create("TextLabel", {
        Name = "Selected",
        Parent = dropdown.Button,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 10, 0, 0),
        Size = UDim2.new(1, -35, 1, 0),
        Font = Enum.Font.Gotham,
        Text = dropdown.Multi and "None selected" or tostring(dropdown.Value),
        TextColor3 = theme.TextSecondary,
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextTruncate = Enum.TextTruncate.AtEnd,
    })
    
    local arrow = Utility.Create("TextLabel", {
        Name = "Arrow",
        Parent = dropdown.Button,
        BackgroundTransparency = 1,
        Position = UDim2.new(1, -25, 0.5, 0),
        Size = UDim2.new(0, 20, 0, 20),
        AnchorPoint = Vector2.new(0, 0.5),
        Font = Enum.Font.GothamBold,
        Text = "â–¼",
        TextColor3 = theme.TextMuted,
        TextSize = 10,
    })
    
    dropdown.OptionsContainer = Utility.Create("Frame", {
        Name = "Options",
        Parent = dropdown.Container,
        BackgroundColor3 = theme.DropdownBg,
        Position = UDim2.new(0, 0, 0, 58),
        Size = UDim2.new(1, 0, 0, 0),
        ClipsDescendants = true,
        ZIndex = 100,
        Visible = false,
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 6),
        Parent = dropdown.OptionsContainer
    })
    
    Utility.Create("UIStroke", {
        Parent = dropdown.OptionsContainer,
        Color = theme.Border,
        Thickness = 1,
    })
    
    dropdown.OptionsScroll = Utility.Create("ScrollingFrame", {
        Name = "Scroll",
        Parent = dropdown.OptionsContainer,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        CanvasSize = UDim2.new(0, 0, 0, 0),
        ScrollBarThickness = 3,
        ScrollBarImageColor3 = theme.Primary,
        AutomaticCanvasSize = Enum.AutomaticSize.Y,
        ZIndex = 101,
    })
    
    Utility.Create("UIListLayout", {
        Parent = dropdown.OptionsScroll,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 2),
    })
    
    Utility.Create("UIPadding", {
        Parent = dropdown.OptionsScroll,
        PaddingTop = UDim.new(0, 4),
        PaddingBottom = UDim.new(0, 4),
        PaddingLeft = UDim.new(0, 4),
        PaddingRight = UDim.new(0, 4),
    })
    
    local function updateSelectedText()
        if dropdown.Multi then
            local selected = {}
            for value, enabled in pairs(dropdown.Value) do
                if enabled then table.insert(selected, value)                end
            end
            if #selected == 0 then
                dropdown.SelectedText.Text = "None selected"
            elseif #selected <= 2 then
                dropdown.SelectedText.Text = table.concat(selected, ", ")
            else
                dropdown.SelectedText.Text = #selected .. " selected"
            end
        else
            dropdown.SelectedText.Text = tostring(dropdown.Value)
        end
    end
    
    local function createOption(value)
        local option = Utility.Create("TextButton", {
            Name = value .. "_Option",
            Parent = dropdown.OptionsScroll,
            BackgroundColor3 = theme.Surface,
            BackgroundTransparency = 1,
            Size = UDim2.new(1, -8, 0, 28),
            Font = Enum.Font.Gotham,
            Text = "",
            ZIndex = 102,
        })
        
        Utility.Create("UICorner", {
            CornerRadius = UDim.new(0, 4),
            Parent = option
        })
        
        local optionText = Utility.Create("TextLabel", {
            Name = "Text",
            Parent = option,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, dropdown.Multi and 28 or 10, 0, 0),
            Size = UDim2.new(1, dropdown.Multi and -36 or -20, 1, 0),
            Font = Enum.Font.Gotham,
            Text = value,
            TextColor3 = theme.TextSecondary,
            TextSize = 12,
            TextXAlignment = Enum.TextXAlignment.Left,
            ZIndex = 103,
        })
        
        local checkbox
        if dropdown.Multi then
            checkbox = Utility.Create("Frame", {
                Name = "Checkbox",
                Parent = option,
                BackgroundColor3 = theme.ToggleOff,
                Position = UDim2.new(0, 6, 0.5, 0),
                Size = UDim2.new(0, 16, 0, 16),
                AnchorPoint = Vector2.new(0, 0.5),
                ZIndex = 103,
            })
            
            Utility.Create("UICorner", {
                CornerRadius = UDim.new(0, 4),
                Parent = checkbox
            })
            
            local checkmark = Utility.Create("TextLabel", {
                Name = "Checkmark",
                Parent = checkbox,
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 1, 0),
                Font = Enum.Font.GothamBold,
                Text = "âœ“",
                TextColor3 = theme.TextPrimary,
                TextSize = 11,
                TextTransparency = 1,
                ZIndex = 104,
            })
            
            if dropdown.Value[value] then
                checkbox.BackgroundColor3 = theme.ToggleOn
                checkmark.TextTransparency = 0
            end
        end
        
        option.MouseEnter:Connect(function()
            Utility.Tween(option, {BackgroundTransparency = 0, BackgroundColor3 = theme.SurfaceHover}, 0.1)
        end)
        
        option.MouseLeave:Connect(function()
            Utility.Tween(option, {BackgroundTransparency = 1}, 0.1)
        end)
        
        option.MouseButton1Click:Connect(function()
            if dropdown.Multi then
                dropdown.Value[value] = not dropdown.Value[value]
                if dropdown.Value[value] then
                    Utility.Tween(checkbox, {BackgroundColor3 = theme.ToggleOn}, 0.15)
                    Utility.Tween(checkbox:FindFirstChild("Checkmark"), {TextTransparency = 0}, 0.15)
                else
                    Utility.Tween(checkbox, {BackgroundColor3 = theme.ToggleOff}, 0.15)
                    Utility.Tween(checkbox:FindFirstChild("Checkmark"), {TextTransparency = 1}, 0.15)
                end
                updateSelectedText()
                dropdown.Callback(dropdown.Value)
            else
                dropdown.Value = value
                updateSelectedText()
                dropdown:Close()
                dropdown.Callback(value)
            end
            
            if dropdown.Flag then
                BloodUI.Flags[dropdown.Flag] = dropdown.Value
            end
        end)
        
        return option
    end
    
    local function refreshOptions()
        for _, child in ipairs(dropdown.OptionsScroll:GetChildren()) do
            if child:IsA("TextButton") then
                child:Destroy()
            end
        end
        
        for _, value in ipairs(dropdown.Values) do
            createOption(value)
        end
    end
    
    refreshOptions()
    
    function dropdown:Open()
        if self.Open then return end
        self.Open = true
        
        self.OptionsContainer.Visible = true
        local height = math.min(#self.Values * 30 + 8, 150)
        
        Utility.Tween(self.OptionsContainer, {Size = UDim2.new(1, 0, 0, height)}, 0.2, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
        Utility.Tween(arrow, {Rotation = 180}, 0.2)
        Utility.Tween(self.Button:FindFirstChildOfClass("UIStroke"), {Color = theme.Primary}, 0.2)
    end
    
    function dropdown:Close()
        if not self.Open then return end
        self.Open = false
        
        Utility.Tween(self.OptionsContainer, {Size = UDim2.new(1, 0, 0, 0)}, 0.15).Completed:Connect(function()
            if not self.Open then
                self.OptionsContainer.Visible = false
            end
        end)
        Utility.Tween(arrow, {Rotation = 0}, 0.2)
        Utility.Tween(self.Button:FindFirstChildOfClass("UIStroke"), {Color = theme.Border}, 0.2)
    end
    
    function dropdown:Toggle()
        if self.Open then
            self:Close()
        else
            self:Open()
        end
    end
    
    function dropdown:SetValue(value)
        self.Value = value
        updateSelectedText()
        self.Callback(value)
    end
    
    function dropdown:SetValues(values)
        self.Values = values
        refreshOptions()
    end
    
    function dropdown:OnChanged(callback)
        self.Callback = callback
        return self
    end
    
    dropdown.Button.MouseButton1Click:Connect(function()
        dropdown:Toggle()
    end)
    
    -- Close when clicking outside
    UserInputService.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            local pos = input.Position
            local absPos = dropdown.Container.AbsolutePosition
            local absSize = dropdown.Container.AbsoluteSize
            
            if dropdown.Open then
                local optAbsPos = dropdown.OptionsContainer.AbsolutePosition
                local optAbsSize = dropdown.OptionsContainer.AbsoluteSize
                
                local inButton = pos.X >= absPos.X and pos.X <= absPos.X + absSize.X and
                                 pos.Y >= absPos.Y and pos.Y <= absPos.Y + 55
                local inOptions = pos.X >= optAbsPos.X and pos.X <= optAbsPos.X + optAbsSize.X and
                                  pos.Y >= optAbsPos.Y and pos.Y <= optAbsPos.Y + optAbsSize.Y
                
                if not inButton and not inOptions then
                    dropdown:Close()
                end
            end
        end
    end)
    
    if dropdown.Flag then
        BloodUI.Flags[dropdown.Flag] = dropdown.Value
    end
    
    table.insert(groupbox.Elements, dropdown)
    BloodUI.Options[config.Flag] = dropdown
    
    return dropdown
end

function Window:CreateButton(groupbox, config)
    config = config or {}
    local theme = self.Theme
    
    local button = {
        Type = "Button",
        Text = config.Text or "Button",
        Callback = config.Callback or function() end,
        DoubleConfirm = config.DoubleConfirm or false,
    }
    
    local awaitingConfirm = false
    
    button.Container = Utility.Create("Frame", {
        Name = button.Text .. "_Button",
        Parent = groupbox.Content,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 32),
        LayoutOrder = #groupbox.Elements + 1,
    })
    
    button.Button = Utility.Create("TextButton", {
        Name = "Button",
        Parent = button.Container,
        BackgroundColor3 = theme.Surface,
        Size = UDim2.new(1, 0, 0, 30),
        Font = Enum.Font.GothamMedium,
        Text = button.Text,
        TextColor3 = theme.TextPrimary,
        TextSize = 13,
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 6),
        Parent = button.Button
    })
    
    Utility.Create("UIStroke", {
        Parent = button.Button,
        Color = theme.Border,
        Thickness = 1,
    })
    
    -- Gradient
    local gradient = Utility.Create("UIGradient", {
        Parent = button.Button,
        Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 255, 255)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(200, 200, 200))
        }),
        Rotation = 90,
        Transparency = NumberSequence.new({
            NumberSequenceKeypoint.new(0, 0.95),
            NumberSequenceKeypoint.new(1, 1)
        })
    })
    
    button.Button.MouseEnter:Connect(function()
        Utility.Tween(button.Button, {BackgroundColor3 = theme.SurfaceHover}, 0.1)
        Utility.Tween(button.Button:FindFirstChildOfClass("UIStroke"), {Color = theme.Primary}, 0.1)
    end)
    
    button.Button.MouseLeave:Connect(function()
        Utility.Tween(button.Button, {BackgroundColor3 = theme.Surface}, 0.1)
        Utility.Tween(button.Button:FindFirstChildOfClass("UIStroke"), {Color = theme.Border}, 0.1)
        if awaitingConfirm then
            awaitingConfirm = false
            button.Button.Text = button.Text
        end
    end)
    
    button.Button.MouseButton1Click:Connect(function()
        if button.DoubleConfirm and not awaitingConfirm then
            awaitingConfirm = true
            button.Button.Text = "Click again to confirm"
            task.delay(3, function()
                if awaitingConfirm then
                    awaitingConfirm = false
                    button.Button.Text = button.Text
                end
            end)
            return
        end
        
        awaitingConfirm = false
        button.Button.Text = button.Text
        
        -- Click animation
        Utility.Tween(button.Button, {BackgroundColor3 = theme.Primary}, 0.1)
        task.delay(0.1, function()
            Utility.Tween(button.Button, {BackgroundColor3 = theme.SurfaceHover}, 0.1)
        end)
        
        Utility.Ripple(button.Button, Vector2.new(Mouse.X, Mouse.Y))
        
        button.Callback()
    end)
    
    table.insert(groupbox.Elements, button)
    
    return button
end

function Window:CreateKeybind(groupbox, config)
    config = config or {}
    local theme = self.Theme
    
    local keybind = {
        Type = "Keybind",
        Name = config.Name or "Keybind",
        Value = config.Default or "None",
        Flag = config.Flag,
        Callback = config.Callback or function() end,
        ChangedCallback = config.ChangedCallback or function() end,
        Listening = false,
    }
    
    keybind.Container = Utility.Create("Frame", {
        Name = keybind.Name .. "_Keybind",
        Parent = groupbox.Content,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 28),
        LayoutOrder = #groupbox.Elements + 1,
    })
    
    local textLabel = Utility.Create("TextLabel", {
        Name = "Label",
        Parent = keybind.Container,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0.5, 0),
        Size = UDim2.new(1, -80, 0, 20),
        AnchorPoint = Vector2.new(0, 0.5),
        Font = Enum.Font.Gotham,
        Text = keybind.Name,
        TextColor3 = theme.TextSecondary,
        TextSize = 13,
        TextXAlignment = Enum.TextXAlignment.Left,
    })
    
    keybind.Button = Utility.Create("TextButton", {
        Name = "Button",
        Parent = keybind.Container,
        BackgroundColor3 = theme.Surface,
        Position = UDim2.new(1, -70, 0.5, 0),
        Size = UDim2.new(0, 70, 0, 24),
        AnchorPoint = Vector2.new(0, 0.5),
        Font = Enum.Font.GothamMedium,
        Text = keybind.Value,
        TextColor3 = theme.TextMuted,
        TextSize = 11,
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 4),
        Parent = keybind.Button
    })
    
    keybind.Button.MouseButton1Click:Connect(function()
        keybind.Listening = true
        keybind.Button.Text = "..."
        Utility.Tween(keybind.Button, {BackgroundColor3 = theme.Primary}, 0.1)
    end)
    
    UserInputService.InputBegan:Connect(function(input, processed)
        if keybind.Listening then
            if input.UserInputType == Enum.UserInputType.Keyboard then
                keybind.Value = input.KeyCode.Name
                keybind.Button.Text = keybind.Value
                keybind.Listening = false
                Utility.Tween(keybind.Button, {BackgroundColor3 = theme.Surface}, 0.1)
                keybind.ChangedCallback(keybind.Value)
                
                if keybind.Flag then
                    BloodUI.Flags[keybind.Flag] = keybind.Value
                end
            elseif input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.MouseButton2 then
                keybind.Value = input.UserInputType.Name
                keybind.Button.Text = keybind.Value
                keybind.Listening = false
                Utility.Tween(keybind.Button, {BackgroundColor3 = theme.Surface}, 0.1)
            end
        elseif not processed then
            if input.UserInputType == Enum.UserInputType.Keyboard then
                if input.KeyCode.Name == keybind.Value then
                    keybind.Callback(keybind.Value)
                end
            end
        end
    end)
    
    function keybind:SetValue(value)
        self.Value = value
        self.Button.Text = value
        if self.Flag then
            BloodUI.Flags[self.Flag] = value
        end
    end
    
    function keybind:OnChanged(callback)
        self.ChangedCallback = callback
        return self
    end
    
    function keybind:OnCallback(callback)
        self.Callback = callback
        return self
    end
    
    if keybind.Flag then
        BloodUI.Flags[keybind.Flag] = keybind.Value
    end
    
    table.insert(groupbox.Elements, keybind)
    BloodUI.Options[config.Flag] = keybind
    
    return keybind
end

function Window:CreateTextbox(groupbox, config)
    config = config or {}
    local theme = self.Theme
    
    local textbox = {
        Type = "Textbox",
        Name = config.Name or "Textbox",
        Value = config.Default or "",
        Placeholder = config.Placeholder or "Enter text...",
        Flag = config.Flag,
        Callback = config.Callback or function() end,
        OnEnter = config.OnEnter or false,
    }
    
    textbox.Container = Utility.Create("Frame", {
        Name = textbox.Name .. "_Textbox",
        Parent = groupbox.Content,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 55),
        LayoutOrder = #groupbox.Elements + 1,
    })
    
    local textLabel = Utility.Create("TextLabel", {
        Name = "Label",
        Parent = textbox.Container,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 20),
        Font = Enum.Font.Gotham,
        Text = textbox.Name,
        TextColor3 = theme.TextSecondary,
        TextSize = 13,
        TextXAlignment = Enum.TextXAlignment.Left,
    })
    
    textbox.Input = Utility.Create("TextBox", {
        Name = "Input",
        Parent = textbox.Container,
        BackgroundColor3 = theme.DropdownBg,
        Position = UDim2.new(0, 0, 0, 24),
        Size = UDim2.new(1, 0, 0, 30),
        Font = Enum.Font.Gotham,
        Text = textbox.Value,
        PlaceholderText = textbox.Placeholder,
        PlaceholderColor3 = theme.TextMuted,
        TextColor3 = theme.TextPrimary,
        TextSize = 12,
        ClearTextOnFocus = false,
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 6),
        Parent = textbox.Input
    })
    
    Utility.Create("UIStroke", {
        Parent = textbox.Input,
        Color = theme.Border,
        Thickness = 1,
    })
    
    Utility.Create("UIPadding", {
        Parent = textbox.Input,
        PaddingLeft = UDim.new(0, 10),
        PaddingRight = UDim.new(0, 10),
    })
    
    textbox.Input.Focused:Connect(function()
        Utility.Tween(textbox.Input:FindFirstChildOfClass("UIStroke"), {Color = theme.Primary}, 0.1)
    end)
    
    textbox.Input.FocusLost:Connect(function(enterPressed)
        Utility.Tween(textbox.Input:FindFirstChildOfClass("UIStroke"), {Color = theme.Border}, 0.1)
        textbox.Value = textbox.Input.Text
        
        if textbox.Flag then
            BloodUI.Flags[textbox.Flag] = textbox.Value
        end
        
        if textbox.OnEnter then
            if enterPressed then
                textbox.Callback(textbox.Value)
            end
        else
            textbox.Callback(textbox.Value)
        end
    end)
    
    function textbox:SetValue(value)
        self.Value = value
        self.Input.Text = value
        if self.Flag then
            BloodUI.Flags[self.Flag] = value
        end
    end
    
    function textbox:OnChanged(callback)
        self.Callback = callback
        return self
    end
    
    if textbox.Flag then
        BloodUI.Flags[textbox.Flag] = textbox.Value
    end
    
    table.insert(groupbox.Elements, textbox)
    BloodUI.Options[config.Flag] = textbox
    
    return textbox
end

function Window:CreateColorPicker(groupbox, config)
    config = config or {}
    local theme = self.Theme
    
    local colorpicker = {
        Type = "ColorPicker",
        Name = config.Name or "Color Picker",
        Value = config.Default or Color3.fromRGB(255, 0, 0),
        Flag = config.Flag,
        Callback = config.Callback or function() end,
        Open = false,
    }
    
    colorpicker.Container = Utility.Create("Frame", {
        Name = colorpicker.Name .. "_ColorPicker",
        Parent = groupbox.Content,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 28),
        ClipsDescendants = false,
        LayoutOrder = #groupbox.Elements + 1,
    })
    
    local textLabel = Utility.Create("TextLabel", {
        Name = "Label",
        Parent = colorpicker.Container,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0.5, 0),
        Size = UDim2.new(1, -45, 0, 20),
        AnchorPoint = Vector2.new(0, 0.5),
        Font = Enum.Font.Gotham,
        Text = colorpicker.Name,
        TextColor3 = theme.TextSecondary,
        TextSize = 13,
        TextXAlignment = Enum.TextXAlignment.Left,
    })
    
    colorpicker.Preview = Utility.Create("TextButton", {
        Name = "Preview",
        Parent = colorpicker.Container,
        BackgroundColor3 = colorpicker.Value,
        Position = UDim2.new(1, -35, 0.5, 0),
        Size = UDim2.new(0, 35, 0, 20),
        AnchorPoint = Vector2.new(0, 0.5),
        Text = "",
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 4),
        Parent = colorpicker.Preview
    })
    
    Utility.Create("UIStroke", {
        Parent = colorpicker.Preview,
        Color = theme.Border,
        Thickness = 1,
    })
    
    -- Color picker popup
    colorpicker.Popup = Utility.Create("Frame", {
        Name = "Popup",
        Parent = colorpicker.Container,
        BackgroundColor3 = theme.Surface,
        Position = UDim2.new(1, -200, 0, 32),
        Size = UDim2.new(0, 200, 0, 0),
        ClipsDescendants = true,
        Visible = false,
        ZIndex = 100,
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 8),
        Parent = colorpicker.Popup
    })
    
    Utility.Create("UIStroke", {
        Parent = colorpicker.Popup,
        Color = theme.Border,
        Thickness = 1,
    })
    
    -- Saturation/Value picker
    colorpicker.SVPicker = Utility.Create("ImageButton", {
        Name = "SVPicker",
        Parent = colorpicker.Popup,
        BackgroundColor3 = Color3.fromHSV(Color3.toHSV(colorpicker.Value)),
        Position = UDim2.new(0, 10, 0, 10),
        Size = UDim2.new(1, -20, 0, 120),
        Image = "rbxassetid://4155801252",
        ZIndex = 101,
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 4),
        Parent = colorpicker.SVPicker
    })
    
    -- SV Cursor
    colorpicker.SVCursor = Utility.Create("Frame", {
        Name = "Cursor",
        Parent = colorpicker.SVPicker,
        BackgroundColor3 = Color3.new(1, 1, 1),
        Size = UDim2.new(0, 10, 0, 10),
        AnchorPoint = Vector2.new(0.5, 0.5),
        ZIndex = 102,
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(1, 0),
        Parent = colorpicker.SVCursor
    })
    
    Utility.Create("UIStroke", {
        Parent = colorpicker.SVCursor,
        Color = Color3.new(0, 0, 0),
        Thickness = 1,
    })
    
    -- Hue picker
    colorpicker.HuePicker = Utility.Create("ImageButton", {
        Name = "HuePicker",
        Parent = colorpicker.Popup,
        BackgroundColor3 = Color3.new(1, 1, 1),
        Position = UDim2.new(0, 10, 0, 140),
        Size = UDim2.new(1, -20, 0, 20),
        Image = "rbxassetid://3641079629",
        ZIndex = 101,
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 4),
        Parent = colorpicker.HuePicker
    })
    
    -- Hue cursor
    colorpicker.HueCursor = Utility.Create("Frame", {
        Name = "Cursor",
        Parent = colorpicker.HuePicker,
        BackgroundColor3 = Color3.new(1, 1, 1),
        Size = UDim2.new(0, 4, 1, 0),
        AnchorPoint = Vector2.new(0.5, 0),
        ZIndex = 102,
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 2),
        Parent = colorpicker.HueCursor
    })
    
    Utility.Create("UIStroke", {
        Parent = colorpicker.HueCursor,
        Color = Color3.new(0, 0, 0),
        Thickness = 1,
    })
    
    local h, s, v = Color3.toHSV(colorpicker.Value)
    
    local function updateColor()
        colorpicker.Value = Color3.fromHSV(h, s, v)
        colorpicker.Preview.BackgroundColor3 = colorpicker.Value
        colorpicker.SVPicker.BackgroundColor3 = Color3.fromHSV(h, 1, 1)
        colorpicker.Callback(colorpicker.Value)
        
        if colorpicker.Flag then
            BloodUI.Flags[colorpicker.Flag] = colorpicker.Value
        end
    end
    
    local function updateCursors()
        colorpicker.SVCursor.Position = UDim2.new(s, 0, 1 - v, 0)
        colorpicker.HueCursor.Position = UDim2.new(h, 0, 0, 0)
    end
    
    updateCursors()
    
    local draggingSV = false
    local draggingHue = false
    
    colorpicker.SVPicker.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            draggingSV = true
        end
    end)
    
    colorpicker.SVPicker.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            draggingSV = false
        end
    end)
    
    colorpicker.HuePicker.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            draggingHue = true
        end
    end)
    
    colorpicker.HuePicker.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            draggingHue = false
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            if draggingSV then
                local pos = input.Position
                local relX = math.clamp((pos.X - colorpicker.SVPicker.AbsolutePosition.X) / colorpicker.SVPicker.AbsoluteSize.X, 0, 1)
                local relY = math.clamp((pos.Y - colorpicker.SVPicker.AbsolutePosition.Y) / colorpicker.SVPicker.AbsoluteSize.Y, 0, 1)
                s = relX
                v = 1 - relY
                updateColor()
                updateCursors()
            elseif draggingHue then
                local pos = input.Position
                local relX = math.clamp((pos.X - colorpicker.HuePicker.AbsolutePosition.X) / colorpicker.HuePicker.AbsoluteSize.X, 0, 1)
                h = relX
                updateColor()
                updateCursors()
            end
        end
    end)
    
    function colorpicker:Toggle()
        self.Open = not self.Open
        if self.Open then
            self.Popup.Visible = true
            Utility.Tween(self.Popup, {Size = UDim2.new(0, 200, 0, 180)}, 0.2, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
        else
            Utility.Tween(self.Popup, {Size = UDim2.new(0, 200, 0, 0)}, 0.15).Completed:Connect(function()
                if not self.Open then
                    self.Popup.Visible = false
                end
            end)
        end
    end
    
    function colorpicker:SetValue(color)
        self.Value = color
        h, s, v = Color3.toHSV(color)
        updateColor()
        updateCursors()
    end
    
    function colorpicker:OnChanged(callback)
        self.Callback = callback
        return self
    end
    
    colorpicker.Preview.MouseButton1Click:Connect(function()
        colorpicker:Toggle()
    end)
    
    -- Close when clicking outside
    UserInputService.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            if colorpicker.Open then
                local pos = input.Position
                local popupPos = colorpicker.Popup.AbsolutePosition
                local popupSize = colorpicker.Popup.AbsoluteSize
                local previewPos = colorpicker.Preview.AbsolutePosition
                local previewSize = colorpicker.Preview.AbsoluteSize
                
                local inPopup = pos.X >= popupPos.X and pos.X <= popupPos.X + popupSize.X and
                                pos.Y >= popupPos.Y and pos.Y <= popupPos.Y + popupSize.Y
                local inPreview = pos.X >= previewPos.X and pos.X <= previewPos.X + previewSize.X and
                                  pos.Y >= previewPos.Y and pos.Y <= previewPos.Y + previewSize.Y
                
                if not inPopup and not inPreview then
                    colorpicker:Toggle()
                end
            end
        end
    end)
    
    if colorpicker.Flag then
        BloodUI.Flags[colorpicker.Flag] = colorpicker.Value
    end
    
    table.insert(groupbox.Elements, colorpicker)
    BloodUI.Options[config.Flag] = colorpicker
    
    return colorpicker
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- WINDOW METHODS
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function Window:Show()
    self.Visible = true
    self.Main.Visible = true
    Utility.Tween(self.Main, {Size = self.Size}, 0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
end

function Window:Hide()
    self.Visible = false
    Utility.Tween(self.Main, {Size = UDim2.new(0, 0, 0, 0)}, 0.2).Completed:Connect(function()
        if not self.Visible then
            self.Main.Visible = false
        end
    end)
end

function Window:Toggle()
    if self.Visible then
        self:Hide()
    else
        self:Show()
    end
end

function Window:ToggleMinimize()
    self.Minimized = not self.Minimized
    
    if self.Minimized then
        Utility.Tween(self.Main, {Size = UDim2.new(0, self.Size.X.Offset, 0, 50)}, 0.2)
        self.ContentContainer.Visible = false
        self.TabContainer.Visible = false
    else
        self.ContentContainer.Visible = true
        self.TabContainer.Visible = true
        Utility.Tween(self.Main, {Size = self.Size}, 0.2, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
    end
end

function Window:Destroy()
    for _, conn in pairs(BloodUI.Connections) do
        pcall(function() conn:Disconnect() end)
    end
    self.ScreenGui:Destroy()
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- GLOBAL METHODS
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function BloodUI:SetTheme(themeName)
    if self.Themes[themeName] then
        self.CurrentTheme = themeName
        self.Theme = self.Themes[themeName]
        -- Optionally refresh all windows with new theme
    end
end

function BloodUI:Notify(config)
    return NotificationSystem:Notify(config)
end

function BloodUI:Destroy()
    for _, window in pairs(self.Windows) do
        window:Destroy()
    end
    NotificationSystem:ClearAll()
    if NotificationSystem.Container and NotificationSystem.Container.Parent then
        NotificationSystem.Container.Parent:Destroy()
    end
end

function BloodUI:GetFlag(flag)
    return self.Flags[flag]
end

function BloodUI:SetFlag(flag, value)
    self.Flags[flag] = value
    if self.Options[flag] then
        self.Options[flag]:SetValue(value)
    end
end

return BloodUI
